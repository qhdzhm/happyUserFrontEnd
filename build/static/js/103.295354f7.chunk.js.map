{"version":3,"file":"static/js/103.295354f7.chunk.js","mappings":"kLAOO,MAAMA,EAAcC,IACzB,IAAKA,EAAY,MAAO,GAGxB,IAAIC,EACJ,IAEE,GAA0B,kBAAfD,EAAyB,CAElC,MAAME,EAAkBF,EAAWG,OAEnC,GAAID,EAAgBE,MAAM,8BAExBH,EAAO,IAAII,KAAKH,QACX,GAAIA,EAAgBE,MAAM,6BAA8B,CAE7D,MAAME,EAAQJ,EAAgBK,MAAM,KACpCN,EAAO,IAAII,KAAKC,EAAM,GAAIA,EAAM,GAAK,EAAGA,EAAM,GAChD,MAAO,GAAIJ,EAAgBE,MAAM,6BAA8B,CAE7D,MAAME,EAAQJ,EAAgBK,MAAM,KACpCN,EAAO,IAAII,KAAKC,EAAM,GAAIA,EAAM,GAAK,EAAGA,EAAM,GAChD,MAEEL,EAAO,IAAII,KAAKH,EAEpB,KAAO,MAAIF,aAAsBK,MAI/B,MAAO,GAFPJ,EAAOD,CAGT,CAGA,OAAIQ,MAAMP,EAAKQ,YACbC,QAAQC,KAAK,8CAAYX,GAClB,IAIFC,EAAKW,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,MAAO,OAAQC,IAAK,WACjF,CAAE,MAAOC,GAEP,OADAN,QAAQM,MAAM,8CAAYA,EAAOhB,GAC1B,EACT,GAQWiB,EAA4BC,UACvC,IAAK,IAADC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACFd,QAAQe,IAAI,wFAAmBC,GAG/B,MAAM,MAAEC,SAAgB,sHAClBC,SAAqB,6HAAuBC,QAGlD,IAAIC,EAAW,EACXJ,EAAUK,MAA2C,kBAA5BL,EAAUK,KAAKD,WAA0BtB,MAAMkB,EAAUK,KAAKD,UACzFA,EAAWE,KAAKC,IAAIP,EAAUK,KAAKD,SAAU,GACpCJ,EAAUI,UAA0C,kBAAvBJ,EAAUI,WAA0BtB,MAAMkB,EAAUI,YAC1FA,EAAWE,KAAKC,IAAIP,EAAUI,SAAU,IAI1C,IAAII,EAAYR,EAAUS,gBAA+B,QAAlBhB,EAAIO,EAAUK,YAAI,IAAAZ,OAAA,EAAdA,EAAgBe,YAAaR,EAAUU,WAC9EC,EAAUX,EAAUY,aAA4B,QAAlBlB,EAAIM,EAAUK,YAAI,IAAAX,OAAA,EAAdA,EAAgBiB,SAGtD,GAAIH,KAAeG,GAAWH,IAAcG,IAAYP,EAAW,EACjE,IACE,MAAMS,EAAQ,IAAIlC,KAAK6B,GACvB,IAAK1B,MAAM+B,EAAM9B,WAAY,CAE3B,MAAM+B,EAAM,IAAInC,KAAKkC,GACrBC,EAAIC,QAAQF,EAAMG,UAAYZ,EAAW,GACzCO,EAAUG,EAAIG,cAAcpC,MAAM,KAAK,EACzC,CACF,CAAE,MAAOqC,GACPlC,QAAQM,MAAM,oDAAa4B,EAC7B,CAGFlC,QAAQe,IAAI,kFAAkB,CAACS,YAAWG,UAASP,aAGnD,MAAMe,EAAgBnB,EAAUmB,eAAiB,CAAC,EAG5CC,EAAmBD,EAAcE,WAAaC,MAAMC,QAAQJ,EAAcE,YAAcF,EAAcE,UAAUG,OAAS,EACzHC,EAAmBL,EAAmBD,EAAcE,UAAUG,OAAS,EAC7ExC,QAAQe,IAAI,iDAAe0B,GAG3B,MAAMC,EAAiBN,EAAmBd,KAAKC,IAAIkB,EAAkBrB,GAAYA,EACjFpB,QAAQe,IAAI,0DAAc2B,GAG1B,MAAMC,GAA4B,QAAdhC,EAAAK,EAAUK,YAAI,IAAAV,OAAA,EAAdA,EAAgBiC,OAAQ5B,EAAU6B,UAAYV,EAAcW,OAASX,EAAcS,MAAQ,6CAC/G5C,QAAQe,IAAI,4BAAS4B,GAGrB,MAAMI,EAAwBA,KAC5B,IAAIC,EAAgB,GAGpB,GAAIZ,EAAkB,CACpBpC,QAAQe,IAAI,2FAGY,IAAIoB,EAAcE,WAAWY,MAAK,CAACC,EAAGC,KAC3DD,EAAEE,YAAc,IAAMD,EAAEC,YAAc,KAIzBC,SAAQ,CAAChD,EAAKiD,KAC5B,MAAMC,EAAYlD,EAAI+C,YAAeE,EAAQ,EAG7C,IAAIE,EAAW,GAIXA,EAHAnD,EAAIyC,MAEFzC,EAAIyC,MAAMW,SAAS,SAADC,OAAKH,EAAS,YAAQlD,EAAIyC,MAAMW,SAAS,OAADC,OAAQH,IACzDlD,EAAIyC,MAEP,SAAAY,OAAOH,EAAS,YAAAG,OAAMrD,EAAIyC,OAG5B,SAAAY,OAAOH,EAAS,YAAAG,OAAoB,IAAdH,EAAkB,4BAAUA,IAAcb,EAAiB,4BAAU,4BAIrG,IAAIiB,EAAaH,EACbA,EAASC,SAAS,SAADC,OAAKH,EAAS,YACjCI,EAAaH,EAASI,UAAUJ,EAASK,QAAQ,KAAO,GAAGpE,OAClD+D,EAASC,SAAS,SAADC,OAAKH,EAAS,mBACxCI,EAAaH,EAASI,UAAUJ,EAASK,QAAQ,UAAO,GAAGpE,QAG7DuD,GAAa,6HAAAU,OAE8CH,EAAS,YAAAG,OAAMC,EAAU,sBAIhFtD,EAAIyD,aAAezD,EAAIyD,YAAYrE,SACrCuD,GAAa,uFAAAU,OAC2DK,EAAc1D,EAAIyD,aAAY,yBAKxG,IAAIE,EAAqB,GAErB3D,EAAI4D,gBACND,GAAkB,0HAAAN,OAE6BrD,EAAI4D,cAAa,0CAK9D5D,EAAI6D,QACNF,GAAkB,8FAAAN,OAE6BrD,EAAI6D,MAAK,0CAKtDF,IACFhB,GAAa,mEAAAU,OACuCM,EAAkB,yBAIxEhB,GAAiB,QAAQ,GAE7B,KAAO,CAELhD,QAAQe,IAAI,+HACZ,IAAK,IAAIoD,EAAI,EAAGA,GAAKzB,EAAgByB,IAAK,CACxC,IAAIC,EAAiB,GAGnBA,EADQ,IAAND,EACe,4BACRA,IAAMzB,EACE,4BAEA,2BAGnBM,GAAa,wCAAAU,OAA4CS,EAAC,KAAAT,OAAIU,EAAc,SAC9E,CAGIjC,EAAc2B,cAChBd,GAAa,mGAAAU,OAEPK,EAAc5B,EAAc2B,aAAY,oCAIlD,CAWA,OARI3B,GAAiBA,EAAckC,OACjCrB,GAAa,8GAAAU,OAEPK,EAAc5B,EAAckC,MAAK,iCAKlCrB,CAAa,EAIhBe,EAAiBO,IACrB,IAAKA,EAAM,MAAO,GAElB,IAAIC,EAAOD,EAAKE,QAAQ,UAAW,KACpBA,QAAQ,SAAU,KAClBA,QAAQ,QAAS,KACjBA,QAAQ,QAAS,KACjBA,QAAQ,UAAW,KACnBA,QAAQ,SAAU,KAWjC,OARAD,EAAOA,EAAKC,QAAQ,eAAgB,MAGpCD,EAAOA,EAAKC,QAAQ,WAAY,IAGhCD,EAAOA,EAAKC,QAAQ,OAAQ,KAAK/E,OAE1B8E,CAAI,EAIPE,EAAM,IAAIxD,EAAM,CACpByD,YAAa,WACbC,KAAM,KACNC,OAAQ,OAIJC,EAAYC,SAASC,cAAc,OACzCF,EAAUG,MAAMC,QAAU,OAC1BJ,EAAUG,MAAME,WAAa,oBAC7BL,EAAUG,MAAMG,SAAW,QAC3BN,EAAUG,MAAMI,SAAW,WAC3BP,EAAUG,MAAMK,KAAO,UAEvBR,EAAUS,UAAS,sxCAAA5B,OAsBiB1C,EAAUuE,IAAMvE,EAAUwE,aAAe,IAAG,qLAAA9B,OAI5CrE,EAAW2B,EAAUyE,YAAc,IAAG,8KAAA/B,QAIrB,QAAjB9C,EAAAI,EAAU0E,eAAO,IAAA9E,OAAA,EAAjBA,EAAmBgC,OAAQ5B,EAAU2E,eAAiB,IAAG,sLAAAjC,QAIxC,QAAjB7C,EAAAG,EAAU0E,eAAO,IAAA7E,OAAA,EAAjBA,EAAmB+E,QAAS5E,EAAU6E,cAAgB,IAAG,6LAAAnC,OAKnFrE,EAAWmC,IAAc,IAAG,kBAAAkC,OAC5B/B,GAAWH,IAAcG,EAAO,MAAA+B,OAC1BrE,EAAWsC,IACf,GAAE,wMAAA+B,OAK8Bf,EAAW,2sBAAAe,OAgB7C1C,EAAU8E,iBAAgC,QAAlBhF,EAAIE,EAAUK,YAAI,IAAAP,OAAA,EAAdA,EAAgBgF,iBAAkB,MAAK,gOAW7EhB,SAASiB,KAAKC,YAAYnB,GAE1B,IAEE,MAAMoB,QAAwB/E,EAAY2D,EAAW,CACnDqB,MAAO,EACPC,SAAS,EACTC,SAAS,IAIXtB,SAASiB,KAAKM,YAAYxB,GAG1B,MAAMyB,EAAW7B,EAAI8B,SAASC,SAASC,WACjCC,EAAaT,EAAgBU,OAASL,EAAYL,EAAgBW,MACxEnC,EAAIoC,SAASZ,EAAgBa,UAAU,aAAc,MAAO,EAAG,EAAGR,EAAUI,GAG5E,MAAMK,EAAajC,SAASC,cAAc,OAC1CgC,EAAW/B,MAAMC,QAAU,OAC3B8B,EAAW/B,MAAME,WAAa,oBAC9B6B,EAAW/B,MAAMG,SAAW,QAC5B4B,EAAW/B,MAAMI,SAAW,WAC5B2B,EAAW/B,MAAMK,KAAO,UAExB0B,EAAWzB,UAAS,oYAAA5B,OAM4Cf,EAAW,uFAAAe,OACnB1C,EAAUuE,IAAMvE,EAAUwE,aAAe,IAAG,0VAAA9B,OAS9FX,IAAuB,4OAM7B+B,SAASiB,KAAKC,YAAYe,GAG1BtC,EAAIuC,UAGJ,MAAMC,QAAyB/F,EAAY6F,EAAY,CACrDb,MAAO,EACPC,SAAS,EACTC,SAAS,IAIXtB,SAASiB,KAAKM,YAAYU,GAG1B,MAAMG,EAAoBD,EAAiBN,OAASL,EAAYW,EAAiBL,MACjFnC,EAAIoC,SAASI,EAAiBH,UAAU,aAAc,MAAO,EAAG,EAAGR,EAAUY,GAG7E,MAAMC,EAAYrC,SAASC,cAAc,OACzCoC,EAAUnC,MAAMC,QAAU,OAC1BkC,EAAUnC,MAAME,WAAa,oBAC7BiC,EAAUnC,MAAMG,SAAW,QAC3BgC,EAAUnC,MAAMI,SAAW,WAC3B+B,EAAUnC,MAAMK,KAAO,UAEvB8B,EAAU7B,UAAS,oYAAA5B,OAM6Cf,EAAW,uFAAAe,OACnB1C,EAAUuE,IAAMvE,EAAUwE,aAAe,IAAG,upEA6BpGV,SAASiB,KAAKC,YAAYmB,GAG1B1C,EAAIuC,UAGJ,MAAMI,QAAwBlG,EAAYiG,EAAW,CACnDjB,MAAO,EACPC,SAAS,EACTC,SAAS,IAIXtB,SAASiB,KAAKM,YAAYc,GAG1B,MAAME,EAAmBD,EAAgBT,OAASL,EAAYc,EAAgBR,MAM9E,OALAnC,EAAIoC,SAASO,EAAgBN,UAAU,aAAc,MAAO,EAAG,EAAGR,EAAUe,GAE5ErH,QAAQe,IAAI,8CAGL0D,EAAI6C,OAAO,OACpB,CAAE,MAAOhH,GAMP,MAJIwE,SAASiB,KAAKwB,SAAS1C,IACzBC,SAASiB,KAAKM,YAAYxB,GAE5B7E,QAAQM,MAAM,+BAAYA,GACpBA,CACR,CACF,CAAE,MAAOA,GAEP,MADAN,QAAQM,MAAM,mEAAkBA,GAC1B,IAAIkH,MAAM,+FAAsBlH,EAAMmH,QAC9C,GASWC,EAAc,SAACC,GAA2B,IAApBC,EAAQC,UAAArF,OAAA,QAAAsF,IAAAD,UAAA,GAAAA,UAAA,GAAG,IAC5C,GAAc,OAAVF,QAA4BG,IAAVH,EAAqB,MAAM,GAANjE,OAAUkE,EAAQ,KAG7D,MAAMG,EAAWC,OAAOL,GACxB,OAAI7H,MAAMiI,GAAiB,GAANrE,OAAUkE,EAAQ,KAGjC,GAANlE,OAAUkE,GAAQlE,OAAGqE,EAASE,eAAe,QAAS,CACpDC,sBAAuB,EACvBC,sBAAuB,IAE3B,EAiMaC,EAAuB5H,UAClC,IAAK,IAAD6H,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACF7I,QAAQe,IAAI,kFAAkBC,GAG9B,MAAM,MAAEC,SAAgB,sHAClBC,SAAqB,6HAAuBC,QAGlD,IAAIK,EAAYR,EAAUS,gBAA+B,QAAlB4G,EAAIrH,EAAUK,YAAI,IAAAgH,OAAA,EAAdA,EAAgB7G,YAAaR,EAAUU,WAC9EC,EAAUX,EAAUY,aAA4B,QAAlB0G,EAAItH,EAAUK,YAAI,IAAAiH,OAAA,EAAdA,EAAgB3G,SAGtD,MAAMgB,GAA4B,QAAd4F,EAAAvH,EAAUK,YAAI,IAAAkH,OAAA,EAAdA,EAAgB3F,OAAQ5B,EAAU6B,WAAmC,QAA3B2F,EAAIxH,EAAUmB,qBAAa,IAAAqG,OAAA,EAAvBA,EAAyB1F,SAAgC,QAA3B2F,EAAIzH,EAAUmB,qBAAa,IAAAsG,OAAA,EAAvBA,EAAyB7F,OAAQ,6CAG/H6B,EAAM,IAAIxD,EAAM,CACpByD,YAAa,WACbC,KAAM,KACNC,OAAQ,OAIJkE,EAAchE,SAASC,cAAc,OAC3C+D,EAAY9D,MAAMC,QAAU,OAC5B6D,EAAY9D,MAAME,WAAa,oBAC/B4D,EAAY9D,MAAMG,SAAW,QAC7B2D,EAAY9D,MAAMI,SAAW,WAC7B0D,EAAY9D,MAAMK,KAAO,UAGzB,MAAM0D,EAAa,OAAArF,OAAU1C,EAAUuE,IAAMvE,EAAUwE,aAAe,GAAE,KAAA9B,QAAI,IAAI/D,MAAOI,UAAUiJ,WAAWC,OAAO,IAG7GC,EAAalI,EAAUmI,OAASnI,EAAUkI,YAAc,EAKxDE,EAAWF,EAAa,IACxBG,EAAMH,EAAaE,EAGnBE,EAAc,IAAI3J,KAAKqB,EAAUyE,WACvC6D,EAAYvH,QAAQuH,EAAYtH,UAAY,GAE5C8G,EAAYxD,UAAS,w/CAAA5B,QA2BkC,QAAjBgF,EAAA1H,EAAU0E,eAAO,IAAAgD,OAAA,EAAjBA,EAAmB9F,OAAQ5B,EAAU2E,eAAiB,IAAG,8EAAAjC,QAClC,QAAjBiF,EAAA3H,EAAU0E,eAAO,IAAAiD,OAAA,EAAjBA,EAAmB/C,QAAS5E,EAAU6E,cAAgB,IAAG,wVAAAnC,OAQ/DqF,EAAa,iMAAArF,OAIbrE,EAAW2B,EAAUyE,YAAc,IAAG,iMAAA/B,OAItCrE,EAAWiK,IAAgB,IAAG,sLAAA5F,OAI9B1C,EAAUuE,IAAMvE,EAAUwE,aAAe,IAAG,ikCAAA9B,OAqBtCf,EAAW,+SAAAe,OAM3CrE,EAAWmC,IAAc,IAAG,oBAAAkC,OAC5B/B,GAAWH,IAAcG,EAAO,MAAA+B,OAC1BrE,EAAWsC,IACf,GAAE,2HAAA+B,SAGW,QAAdkF,EAAA5H,EAAUK,YAAI,IAAAuH,OAAA,EAAdA,EAAgBW,SAAU,KAAoB,QAAdV,EAAA7H,EAAUK,YAAI,IAAAwH,OAAA,EAAdA,EAAgBW,WAAY,GAAE,0HAAA9F,OAG/DgE,EAAY0B,GAAS,2WAAA1F,OAUrBgE,EAAY0B,GAAS,0TAAA1F,OAQrBgE,EAAY2B,GAAI,qYAAA3F,OAQhBgE,EAAYwB,GAAW,uWAAAxF,OAQvBgE,EAAYwB,GAAW,wWAAAxF,OAQvBgE,EAAY,GAAE,wqCA2B1B5C,SAASiB,KAAKC,YAAY8C,GAE1B,IAEE,MAAMW,QAAsBvI,EAAY4H,EAAa,CACnD5C,MAAO,EACPC,SAAS,EACTC,SAAS,IAIXtB,SAASiB,KAAKM,YAAYyC,GAG1B,MAAMxC,EAAW7B,EAAI8B,SAASC,SAASC,WACjCC,EAAa+C,EAAc9C,OAASL,EAAYmD,EAAc7C,MAMpE,OALAnC,EAAIoC,SAAS4C,EAAc3C,UAAU,aAAc,MAAO,EAAG,EAAGR,EAAUI,GAE1E1G,QAAQe,IAAI,wCAGL0D,EAAI6C,OAAO,OACpB,CAAE,MAAOhH,GAMP,MAJIwE,SAASiB,KAAKwB,SAASuB,IACzBhE,SAASiB,KAAKM,YAAYyC,GAE5B9I,QAAQM,MAAM,+BAAYA,GACpBA,CACR,CACF,CAAE,MAAOA,GAEP,MADAN,QAAQM,MAAM,6DAAiBA,GACzB,IAAIkH,MAAM,yFAAqBlH,EAAMmH,QAC7C,E","sources":["utils/helpers.js"],"sourcesContent":["/**\n * 格式化日期字符串为易读格式\n * 支持多种日期格式，包括ISO格式和普通日期字符串\n * @param {string} dateString - 要格式化的日期字符串\n * @param {string} locale - 日期本地化格式，默认为中文 'zh-CN'\n * @returns {string} - 格式化后的日期字符串，格式为'YYYY年MM月DD日'\n */\nexport const formatDate = (dateString) => {\n  if (!dateString) return '';\n  \n  // 尝试将日期字符串转换为日期对象\n  let date;\n  try {\n    // 尝试解析不同格式的日期\n    if (typeof dateString === 'string') {\n      // 清理日期字符串，移除额外的空格和字符\n      const cleanDateString = dateString.trim();\n      \n      if (cleanDateString.match(/^\\d{4}-\\d{2}-\\d{2}(T|\\s|$)/)) {\n        // ISO格式日期: YYYY-MM-DD 或 YYYY-MM-DDTxx:xx:xx\n        date = new Date(cleanDateString);\n      } else if (cleanDateString.match(/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}$/)) {\n        // 美式日期: MM/DD/YYYY\n        const parts = cleanDateString.split('/');\n        date = new Date(parts[2], parts[0] - 1, parts[1]);\n      } else if (cleanDateString.match(/^\\d{1,2}\\.\\d{1,2}\\.\\d{4}$/)) {\n        // 欧式日期: DD.MM.YYYY\n        const parts = cleanDateString.split('.');\n        date = new Date(parts[2], parts[1] - 1, parts[0]);\n      } else {\n        // 尝试直接解析\n        date = new Date(cleanDateString);\n      }\n    } else if (dateString instanceof Date) {\n      // 如果已经是Date对象，直接使用\n      date = dateString;\n    } else {\n      return '';\n    }\n    \n    // 检查日期是否有效\n    if (isNaN(date.getTime())) {\n      console.warn('无效的日期格式:', dateString);\n      return '';\n    }\n    \n    // 使用toLocaleDateString格式化日期\n    return date.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });\n  } catch (error) {\n    console.error('格式化日期出错:', error, dateString);\n    return '';\n  }\n};\n\n/**\n * 生成订单确认单PDF\n * @param {Object} orderData - 订单数据对象，包含itineraryData行程数据\n * @returns {Promise<Blob>} - 返回PDF文件的Blob对象\n */\nexport const generateOrderConfirmation = async (orderData) => {\n  try {\n    console.log('开始生成确认单，接收到的数据:', orderData);\n    \n    // 动态导入jsPDF和html2canvas\n    const { jsPDF } = await import('jspdf');\n    const html2canvas = (await import('html2canvas')).default;\n    \n    // 确保duration是有效数字\n    let duration = 1;\n    if (orderData.tour && typeof orderData.tour.duration === 'number' && !isNaN(orderData.tour.duration)) {\n      duration = Math.max(orderData.tour.duration, 1);\n    } else if (orderData.duration && typeof orderData.duration === 'number' && !isNaN(orderData.duration)) {\n      duration = Math.max(orderData.duration, 1);\n    }\n    \n    // 计算正确的开始和结束日期\n    let startDate = orderData.departureDate || orderData.tour?.startDate || orderData.pickupDate;\n    let endDate = orderData.returnDate || orderData.tour?.endDate;\n    \n    // 如果有开始日期但没有结束日期，或开始日期等于结束日期但行程超过1天\n    if (startDate && (!endDate || startDate === endDate) && duration > 1) {\n      try {\n        const start = new Date(startDate);\n        if (!isNaN(start.getTime())) {\n          // 根据行程天数计算结束日期（开始日期 + 行程天数 - 1）\n          const end = new Date(start);\n          end.setDate(start.getDate() + duration - 1);\n          endDate = end.toISOString().split('T')[0];\n        }\n      } catch (e) {\n        console.error('计算结束日期出错:', e);\n      }\n    }\n    \n    console.log('确认单使用的日期和行程天数:', {startDate, endDate, duration});\n    \n    // 处理行程信息，确保行程天数与实际数据匹配\n    const itineraryData = orderData.itineraryData || {};\n    \n    // 如果有itinerary数据，获取天数\n    const hasItineraryDays = itineraryData.itinerary && Array.isArray(itineraryData.itinerary) && itineraryData.itinerary.length > 0;\n    const apiItineraryDays = hasItineraryDays ? itineraryData.itinerary.length : 0;\n    console.log('API返回的行程天数:', apiItineraryDays);\n    \n    // 取API返回的天数和订单天数中的较大值\n    const actualDuration = hasItineraryDays ? Math.max(apiItineraryDays, duration) : duration;\n    console.log('最终使用的行程天数:', actualDuration);\n    \n    // 确保有产品名称\n    const productName = orderData.tour?.name || orderData.tourName || itineraryData.title || itineraryData.name || '塔斯马尼亚旅游';\n    console.log('产品名称:', productName);\n    \n    // 生成行程天数的HTML\n    const generateItineraryDays = () => {\n      let itineraryHtml = '';\n      \n      // 如果API返回了行程数据，使用API数据\n      if (hasItineraryDays) {\n        console.log('使用API返回的行程数据生成确认单');\n        \n        // 有详细的行程数据，按天展示\n        const sortedItinerary = [...itineraryData.itinerary].sort((a, b) => \n          (a.day_number || 0) - (b.day_number || 0)\n        );\n        \n        // 对每天的行程进行格式化显示\n        sortedItinerary.forEach((day, index) => {\n          const dayNumber = day.day_number || (index + 1);\n          \n          // 构建天数标题，例如 \"第1天: 霍巴特市游-萨拉曼卡-惠灵顿山-里奇蒙小镇\"\n          let dayTitle = '';\n          if (day.title) {\n            // 如果标题已经包含\"第X天\"，则直接使用\n            if (day.title.includes(`第${dayNumber}天`) || day.title.includes(`Day ${dayNumber}`)) {\n              dayTitle = day.title;\n            } else {\n              dayTitle = `第${dayNumber}天: ${day.title}`;\n            }\n          } else {\n            dayTitle = `第${dayNumber}天: ${dayNumber === 1 ? '抵达&接机' : dayNumber === actualDuration ? '送机&离开' : '行程安排'}`;\n          }\n          \n          // 移除重复的\"第X天:\"前缀\n          let cleanTitle = dayTitle;\n          if (dayTitle.includes(`第${dayNumber}天:`)) {\n            cleanTitle = dayTitle.substring(dayTitle.indexOf(':') + 1).trim();\n          } else if (dayTitle.includes(`第${dayNumber}天：`)) {\n            cleanTitle = dayTitle.substring(dayTitle.indexOf('：') + 1).trim();\n          }\n          \n          itineraryHtml += `\n            <div style=\"margin-bottom: 12px;\">\n              <div style=\"font-weight: bold; margin-bottom: 3px;\">第${dayNumber}天: ${cleanTitle}</div>\n          `;\n          \n          // 添加行程描述\n          if (day.description && day.description.trim()) {\n            itineraryHtml += `\n              <div style=\"margin-left: 8px; margin-bottom: 5px; font-size: 12px;\">${stripHtmlTags(day.description)}</div>\n            `;\n          }\n          \n          // 添加住宿和餐食信息\n          let accommodationMeals = '';\n          \n          if (day.accommodation) {\n            accommodationMeals += `\n              <span style=\"margin-right: 15px;\">\n                <span style=\"color: #0066cc;\">住宿:</span> ${day.accommodation}\n              </span>\n            `;\n          }\n          \n          if (day.meals) {\n            accommodationMeals += `\n              <span>\n                <span style=\"color: #0066cc;\">用餐:</span> ${day.meals}\n              </span>\n            `;\n          }\n          \n          if (accommodationMeals) {\n            itineraryHtml += `\n              <div style=\"margin-left: 8px; font-size: 12px;\">${accommodationMeals}</div>\n            `;\n          }\n          \n          itineraryHtml += '</div>';\n        });\n      } else {\n        // 没有详细行程数据，生成基本的行程天数\n        console.log('没有API行程数据，使用基本行程天数生成确认单');\n        for (let i = 1; i <= actualDuration; i++) {\n          let dayDescription = '';\n          \n          if (i === 1) {\n            dayDescription = '抵达&接机';\n          } else if (i === actualDuration) {\n            dayDescription = '送机&离开';\n          } else {\n            dayDescription = '行程安排';\n          }\n          \n          itineraryHtml += `<div style=\"margin-bottom: 8px;\">Day ${i} ${dayDescription}</div>`;\n        }\n        \n        // 如果有整体行程描述，添加它\n        if (itineraryData.description) {\n          itineraryHtml += `\n            <div style=\"margin-top: 10px; font-size: 12px; margin-left: 5px;\">\n              ${stripHtmlTags(itineraryData.description)}\n            </div>\n          `;\n        }\n      }\n      \n      // 添加行程备注\n      if (itineraryData && itineraryData.note) {\n        itineraryHtml += `\n          <div style=\"margin-top: 10px; font-style: italic; font-size: 12px; color: #666;\">\n            ${stripHtmlTags(itineraryData.note)}\n          </div>\n        `;\n      }\n      \n      return itineraryHtml;\n    };\n    \n    // 辅助函数: 去除HTML标签，保留文本内容\n    const stripHtmlTags = (html) => {\n      if (!html) return '';\n      // 先替换一些常见的HTML实体\n      let text = html.replace(/&nbsp;/g, ' ')\n                    .replace(/&amp;/g, '&')\n                    .replace(/&lt;/g, '<')\n                    .replace(/&gt;/g, '>')\n                    .replace(/&quot;/g, '\"')\n                    .replace(/&#39;/g, \"'\");\n      \n      // 替换<br>标签为换行符\n      text = text.replace(/<br\\s*\\/?>/gi, '\\n');\n      \n      // 移除所有其他HTML标签但保留其内容\n      text = text.replace(/<[^>]*>/g, '');\n      \n      // 清理多余的空白\n      text = text.replace(/\\s+/g, ' ').trim();\n      \n      return text;\n    };\n\n    // 创建PDF\n    const pdf = new jsPDF({\n      orientation: 'portrait',\n      unit: 'mm',\n      format: 'a4'\n    });\n    \n    // ==================== 生成第一页 - 基本信息 ====================\n    const firstPage = document.createElement('div');\n    firstPage.style.padding = '20px';\n    firstPage.style.fontFamily = 'Arial, sans-serif';\n    firstPage.style.maxWidth = '800px';\n    firstPage.style.position = 'absolute';\n    firstPage.style.left = '-9999px';\n    \n    firstPage.innerHTML = `\n      <div style=\"margin-bottom: 30px; display: flex; align-items: center;\">\n        <!-- Logo放在左侧 -->\n        <div style=\"width: 140px; margin-right: 20px;\">\n          <img src=\"/logo192.png\" alt=\"Happy Tassie Travel\" style=\"max-width: 100%; height: auto;\" />\n        </div>\n        \n        <!-- 标题和公司名称放在右侧 -->\n        <div style=\"flex: 1; text-align: center;\">\n          <h1 style=\"margin: 0; color: #333; font-size: 28px; font-weight: bold;\">确认函</h1>\n          <div style=\"font-size: 16px; color: #666; margin-top: 5px;\">Happy Tassie Holiday</div>\n          <div style=\"font-size: 12px; color: #999; font-style: italic;\">Your Local Experts of Tasmania</div>\n        </div>\n      </div>\n      \n      <div style=\"margin-bottom: 20px; padding: 5px; background-color: #f2f2f2;\">\n        <h2 style=\"margin: 0; font-size: 16px; color: #333; padding: 3px;\">预订详情</h2>\n      </div>\n      \n      <table style=\"width: 100%; border-collapse: collapse; font-size: 14px; margin-bottom: 20px;\">\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; width: 180px; color: #333;\">订单号/订单号:</td>\n          <td style=\"padding: 8px 0;\">${orderData.id || orderData.orderNumber || '-'}</td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; color: #333;\">下单日期/Issue Date:</td>\n          <td style=\"padding: 8px 0;\">${formatDate(orderData.createdAt) || '-'}</td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; color: #333;\">联系人/Passenger:</td>\n          <td style=\"padding: 8px 0;\">${orderData.contact?.name || orderData.contactPerson || '-'}</td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; color: #333;\">联系方式/Contact No.:</td>\n          <td style=\"padding: 8px 0;\">${orderData.contact?.phone || orderData.contactPhone || '-'}</td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; color: #333;\">行程日期/Date:</td>\n          <td style=\"padding: 8px 0;\">\n            ${formatDate(startDate) || '-'}\n            ${endDate && startDate !== endDate ? \n              ` - ${formatDate(endDate)}` \n              : ''}\n          </td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; color: #333;\">行程路线/Itinerary:</td>\n          <td style=\"padding: 8px 0;\"><strong>${productName}</strong></td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; color: #333;\">导游/Guide:</td>\n          <td style=\"padding: 8px 0;\">TBA</td>\n        </tr>\n      </table>\n      \n      <div style=\"margin-bottom: 20px; padding: 5px; background-color: #f2f2f2;\">\n        <h2 style=\"margin: 0; font-size: 16px; color: #333; padding: 3px;\">航班/接送信息</h2>\n      </div>\n      \n      <table style=\"width: 100%; border-collapse: collapse; font-size: 14px; margin-bottom: 20px;\">\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; width: 180px; color: #333;\">接团/Pick Up:</td>\n          <td style=\"padding: 8px 0;\">\n            ${orderData.pickupLocation || orderData.tour?.pickupLocation || 'TBA'}\n          </td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 10px 8px 0; color: #333;\">送团/Drop Off:</td>\n          <td style=\"padding: 8px 0;\">TBA</td>\n        </tr>\n      </table>\n    `;\n    \n    // 添加第一页到文档\n    document.body.appendChild(firstPage);\n    \n    try {\n      // 使用html2canvas渲染第一页\n      const firstPageCanvas = await html2canvas(firstPage, {\n        scale: 2,\n        useCORS: true,\n        logging: false\n      });\n      \n      // 清理第一页\n      document.body.removeChild(firstPage);\n      \n      // 添加第一页到PDF\n      const pdfWidth = pdf.internal.pageSize.getWidth();\n      const pdfHeight = (firstPageCanvas.height * pdfWidth) / firstPageCanvas.width;\n      pdf.addImage(firstPageCanvas.toDataURL('image/png'), 'PNG', 0, 0, pdfWidth, pdfHeight);\n      \n      // ==================== 生成第二页 - 行程安排 ====================\n      const secondPage = document.createElement('div');\n      secondPage.style.padding = '20px';\n      secondPage.style.fontFamily = 'Arial, sans-serif';\n      secondPage.style.maxWidth = '800px';\n      secondPage.style.position = 'absolute';\n      secondPage.style.left = '-9999px';\n      \n      secondPage.innerHTML = `\n        <div style=\"display: flex; align-items: center; margin-bottom: 15px;\">\n          <div style=\"width: 70px; margin-right: 10px;\">\n            <img src=\"/logo192.png\" alt=\"Happy Tassie Travel\" style=\"max-width: 100%; height: auto;\" />\n          </div>\n          <div style=\"flex: 1;\">\n            <div style=\"font-size: 16px; font-weight: bold;\">行程安排 - ${productName}</div>\n            <div style=\"font-size: 12px; color: #666;\">订单号: ${orderData.id || orderData.orderNumber || '-'}</div>\n          </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px; padding: 5px; background-color: #f2f2f2;\">\n          <h2 style=\"margin: 0; font-size: 16px; color: #333; padding: 3px;\">行程安排</h2>\n        </div>\n        \n        <div style=\"margin-bottom: 20px; font-size: 14px;\">\n          ${generateItineraryDays()}\n          <div style=\"margin-top: 10px; font-style: italic; color: #666; font-size: 12px;\">*行程顺序可能有所调整，以实际发生为准</div>\n        </div>\n      `;\n      \n      // 添加第二页到文档\n      document.body.appendChild(secondPage);\n      \n      // 添加新页面\n      pdf.addPage();\n      \n      // 使用html2canvas渲染第二页\n      const secondPageCanvas = await html2canvas(secondPage, {\n        scale: 2,\n        useCORS: true,\n        logging: false\n      });\n      \n      // 清理第二页\n      document.body.removeChild(secondPage);\n      \n      // 添加第二页到PDF\n      const secondPageHeight = (secondPageCanvas.height * pdfWidth) / secondPageCanvas.width;\n      pdf.addImage(secondPageCanvas.toDataURL('image/png'), 'PNG', 0, 0, pdfWidth, secondPageHeight);\n      \n      // ==================== 生成第三页 - 注意事项 ====================\n      const thirdPage = document.createElement('div');\n      thirdPage.style.padding = '20px';\n      thirdPage.style.fontFamily = 'Arial, sans-serif';\n      thirdPage.style.maxWidth = '800px';\n      thirdPage.style.position = 'absolute';\n      thirdPage.style.left = '-9999px';\n      \n      thirdPage.innerHTML = `\n        <div style=\"display: flex; align-items: center; margin-bottom: 15px;\">\n          <div style=\"width: 70px; margin-right: 10px;\">\n            <img src=\"/logo192.png\" alt=\"Happy Tassie Travel\" style=\"max-width: 100%; height: auto;\" />\n          </div>\n          <div style=\"flex: 1;\">\n            <div style=\"font-size: 16px; font-weight: bold;\">注意事项 - ${productName}</div>\n            <div style=\"font-size: 12px; color: #666;\">订单号: ${orderData.id || orderData.orderNumber || '-'}</div>\n          </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px; padding: 5px; background-color: #f2f2f2;\">\n          <h2 style=\"margin: 0; font-size: 16px; color: #333; padding: 3px;\">注意事项</h2>\n        </div>\n        \n        <div style=\"margin-bottom: 20px; font-size: 14px;\">\n          <div style=\"margin-bottom: 8px;\"><strong>费用包含 INCLUSIONS:</strong></div>\n          <div style=\"margin-bottom: 5px;\">接送: 行程开始及离开当日机场接送及每日酒店接送 Airport transfer & CBD hotel pick up;</div>\n          <div style=\"margin-bottom: 5px;\">交通及陪同: 全程巴士交通以及专业中文导游服务 Coach transportation and professional Chinese speaking tour guide;</div>\n          <div style=\"margin-bottom: 10px;\">门票: 行程内列出门票Admission fee as indicated (薰衣草农场除外Lavender Farm Exclusion);</div>\n          \n          <div style=\"margin-bottom: 8px; margin-top: 12px;\"><strong>费用不含 EXCLUSIONS:</strong></div>\n          <div style=\"margin-bottom: 5px;\">机票: 国际、国内段往返机票及税 International & Domestic airfare & Taxes;</div>\n          <div style=\"margin-bottom: 5px;\">小费: 当地导游小费 AUD$5/人/天 Tipping AUD$5/P/Day payable to the local tour guide;</div>\n          <div style=\"margin-bottom: 5px;\">膳食: 午/晚餐Lunch and Dinner</div>\n          <div style=\"margin-bottom: 5px;\">保险: 建议自行购买旅游保险 Travel Insurance(Highly Recommended)</div>\n        </div>\n        \n        <!-- 添加页脚 -->\n        <div style=\"border-top: 1px solid #ddd; padding-top: 10px; font-size: 12px; color: #666; text-align: center;\">\n          <div>Happy Tassie Travel</div>\n          <div>Email: info@happytassietravel.com | Tel: +61 3 1234 5678</div>\n        </div>\n      `;\n      \n      // 添加第三页到文档\n      document.body.appendChild(thirdPage);\n      \n      // 添加新页面\n      pdf.addPage();\n      \n      // 使用html2canvas渲染第三页\n      const thirdPageCanvas = await html2canvas(thirdPage, {\n        scale: 2,\n        useCORS: true,\n        logging: false\n      });\n      \n      // 清理第三页\n      document.body.removeChild(thirdPage);\n      \n      // 添加第三页到PDF\n      const thirdPageHeight = (thirdPageCanvas.height * pdfWidth) / thirdPageCanvas.width;\n      pdf.addImage(thirdPageCanvas.toDataURL('image/png'), 'PNG', 0, 0, pdfWidth, thirdPageHeight);\n      \n      console.log('确认单生成成功');\n      \n      // 返回PDF的Blob对象\n      return pdf.output('blob');\n    } catch (error) {\n      // 确保临时元素被移除\n      if (document.body.contains(firstPage)) {\n        document.body.removeChild(firstPage);\n      }\n      console.error('生成PDF出错:', error);\n      throw error;\n    }\n  } catch (error) {\n    console.error('生成订单确认单PDF时出错:', error);\n    throw new Error('生成订单确认单失败，请稍后再试: ' + error.message);\n  }\n};\n\n/**\n * 格式化价格\n * @param {number} price - 价格\n * @param {string} currency - 货币符号，默认为 '$'\n * @returns {string} 格式化后的价格字符串\n */\nexport const formatPrice = (price, currency = '$') => {\n  if (price === null || price === undefined) return `${currency}0`;\n  \n  // 确保price是数字\n  const numPrice = Number(price);\n  if (isNaN(numPrice)) return `${currency}0`;\n  \n  // 使用toLocaleString格式化价格，添加千位分隔符\n  return `${currency}${numPrice.toLocaleString('zh-CN', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  })}`;\n};\n\n/**\n * 截断文本\n * @param {string} text - 原始文本\n * @param {number} maxLength - 最大长度\n * @returns {string} 截断后的文本\n */\nexport const truncateText = (text, maxLength) => {\n  if (!text || text.length <= maxLength) {\n    return text;\n  }\n  \n  return text.slice(0, maxLength) + '...';\n};\n\n/**\n * 生成随机ID\n * @param {number} length - ID长度，默认为 8\n * @returns {string} 随机ID\n */\nexport const generateId = (length = 8) => {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  \n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  \n  return result;\n};\n\n/**\n * 深拷贝对象\n * @param {Object} obj - 要拷贝的对象\n * @returns {Object} 拷贝后的对象\n */\nexport const deepClone = (obj) => {\n  if (obj === null || typeof obj !== 'object') {\n    return obj;\n  }\n  \n  if (obj instanceof Date) {\n    return new Date(obj.getTime());\n  }\n  \n  if (obj instanceof Array) {\n    return obj.map(item => deepClone(item));\n  }\n  \n  if (obj instanceof Object) {\n    const copy = {};\n    Object.keys(obj).forEach(key => {\n      copy[key] = deepClone(obj[key]);\n    });\n    return copy;\n  }\n  \n  return obj;\n};\n\n/**\n * 防抖函数\n * @param {Function} func - 要执行的函数\n * @param {number} wait - 等待时间，单位为毫秒\n * @returns {Function} 防抖后的函数\n */\nexport const debounce = (func, wait) => {\n  let timeout;\n  \n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n    \n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n};\n\n/**\n * 节流函数\n * @param {Function} func - 要执行的函数\n * @param {number} limit - 限制时间，单位为毫秒\n * @returns {Function} 节流后的函数\n */\nexport const throttle = (func, limit) => {\n  let inThrottle;\n  \n  return function executedFunction(...args) {\n    if (!inThrottle) {\n      func(...args);\n      inThrottle = true;\n      setTimeout(() => {\n        inThrottle = false;\n      }, limit);\n    }\n  };\n};\n\n/**\n * 获取查询参数\n * @param {string} name - 参数名\n * @param {string} url - URL，默认为当前URL\n * @returns {string|null} 参数值\n */\nexport const getQueryParam = (name, url = window.location.href) => {\n  name = name.replace(/[[\\]]/g, '\\\\$&');\n  const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');\n  const results = regex.exec(url);\n  \n  if (!results) return null;\n  if (!results[2]) return '';\n  \n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n};\n\n/**\n * 滚动到页面顶部\n * @param {number} duration - 动画持续时间，单位为毫秒\n */\nexport const scrollToTop = (duration = 500) => {\n  const scrollStep = -window.scrollY / (duration / 15);\n  \n  const scrollInterval = setInterval(() => {\n    if (window.scrollY !== 0) {\n      window.scrollBy(0, scrollStep);\n    } else {\n      clearInterval(scrollInterval);\n    }\n  }, 15);\n};\n\n/**\n * 验证邮箱\n * @param {string} email - 邮箱地址\n * @returns {boolean} 是否有效\n */\nexport const validateEmail = (email) => {\n  const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  return re.test(String(email).toLowerCase());\n};\n\n/**\n * 验证手机号\n * @param {string} phone - 手机号\n * @returns {boolean} 是否有效\n */\nexport const validatePhone = (phone) => {\n  const re = /^1[3-9]\\d{9}$/;\n  return re.test(String(phone));\n};\n\n/**\n * 计算折扣价格（已弃用 - 请使用后端API计算折扣价格）\n * @deprecated 此方法已弃用，请使用后端API计算折扣价格\n * @param {number} originalPrice - 原价\n * @param {number|string} discountRate - 折扣率，可以是小数(0.8)或百分比(80)格式\n * @returns {number} 折扣后的价格，保留两位小数\n */\nexport const calculateDiscountPrice = (originalPrice, discountRate) => {\n  console.warn('calculateDiscountPrice函数已弃用，请使用后端API计算折扣价格');\n  \n  if (!originalPrice || originalPrice <= 0) return 0;\n  \n  // 确保输入参数为数字\n  const price = Number(originalPrice);\n  let rate = Number(discountRate);\n  \n  // 验证参数是否有效\n  if (isNaN(price) || isNaN(rate) || rate <= 0) {\n    console.warn('计算折扣价格的参数无效', { originalPrice, discountRate });\n    return price;\n  }\n  \n  // 如果折扣率大于1，假设它是百分比格式(例如80)，转换为小数(0.8)\n  if (rate > 1) {\n    rate = rate / 100;\n  }\n  \n  // 计算折扣价\n  const discountedPrice = price * rate;\n  \n  // 保留两位小数\n  return Math.round(discountedPrice * 100) / 100;\n};\n\n/**\n * 生成订单发票PDF\n * @param {Object} orderData - 订单数据对象\n * @returns {Promise<Blob>} - 返回PDF文件的Blob对象\n */\nexport const generateOrderInvoice = async (orderData) => {\n  try {\n    console.log('开始生成发票，接收到的数据:', orderData);\n    \n    // 动态导入jsPDF和html2canvas\n    const { jsPDF } = await import('jspdf');\n    const html2canvas = (await import('html2canvas')).default;\n    \n    // 计算正确的开始和结束日期\n    let startDate = orderData.departureDate || orderData.tour?.startDate || orderData.pickupDate;\n    let endDate = orderData.returnDate || orderData.tour?.endDate;\n    \n    // 确保有产品名称\n    const productName = orderData.tour?.name || orderData.tourName || orderData.itineraryData?.title || orderData.itineraryData?.name || '塔斯马尼亚旅游';\n    \n    // 创建PDF\n    const pdf = new jsPDF({\n      orientation: 'portrait',\n      unit: 'mm',\n      format: 'a4'\n    });\n    \n    // ==================== 生成发票 ====================\n    const invoicePage = document.createElement('div');\n    invoicePage.style.padding = '20px';\n    invoicePage.style.fontFamily = 'Arial, sans-serif';\n    invoicePage.style.maxWidth = '800px';\n    invoicePage.style.position = 'absolute';\n    invoicePage.style.left = '-9999px';\n    \n    // 生成随机发票号\n    const invoiceNumber = `INV-${orderData.id || orderData.orderNumber || ''}-${new Date().getTime().toString().slice(-6)}`;\n    \n    // 计算总价 - 产品价格已经包含GST，无需再次计算\n    const totalPrice = orderData.total || orderData.totalPrice || 0;\n    // 澳洲GST为10%，如果价格已含税，则：\n    // 含税价格 = 不含税价格 × (1 + 0.1)\n    // 不含税价格 = 含税价格 ÷ 1.1\n    // GST = 含税价格 - 不含税价格\n    const subtotal = totalPrice / 1.1;\n    const tax = totalPrice - subtotal;\n    \n    // 计算支付日期 - 假设是订单创建后的第二天\n    const paymentDate = new Date(orderData.createdAt);\n    paymentDate.setDate(paymentDate.getDate() + 1);\n    \n    invoicePage.innerHTML = `\n      <div style=\"margin-bottom: 30px; display: flex; align-items: center;\">\n        <!-- Logo放在左侧 -->\n        <div style=\"width: 140px; margin-right: 20px;\">\n          <img src=\"/logo192.png\" alt=\"Happy Tassie Travel\" style=\"max-width: 100%; height: auto;\" />\n        </div>\n        \n        <!-- 标题和公司名称放在右侧 -->\n        <div style=\"flex: 1; text-align: center;\">\n          <h1 style=\"margin: 0; color: #333; font-size: 28px; font-weight: bold;\">发票 / INVOICE</h1>\n          <div style=\"font-size: 16px; color: #666; margin-top: 5px;\">Happy Tassie Holiday</div>\n          <div style=\"font-size: 12px; color: #999; font-style: italic;\">Your Local Experts of Tasmania</div>\n        </div>\n      </div>\n      \n      <div style=\"display: flex; justify-content: space-between; margin-bottom: 30px;\">\n        <div>\n          <div style=\"font-weight: bold; margin-bottom: 5px;\">供应商 / Supplier:</div>\n          <div style=\"font-size: 14px;\">Happy Tassie Travel Pty Ltd</div>\n          <div style=\"font-size: 14px;\">123 Main Street</div>\n          <div style=\"font-size: 14px;\">Hobart, TAS 7000</div>\n          <div style=\"font-size: 14px;\">Australia</div>\n          <div style=\"font-size: 14px;\">ABN: 12 345 678 901</div>\n        </div>\n        \n        <div>\n          <div style=\"font-weight: bold; margin-bottom: 5px;\">客户 / Customer:</div>\n          <div style=\"font-size: 14px;\">${orderData.contact?.name || orderData.contactPerson || '-'}</div>\n          <div style=\"font-size: 14px;\">联系电话: ${orderData.contact?.phone || orderData.contactPhone || '-'}</div>\n        </div>\n      </div>\n      \n      <div style=\"margin-bottom: 20px;\">\n        <table style=\"width: 100%; border-collapse: collapse; font-size: 14px;\">\n          <tr>\n            <td style=\"padding: 8px 10px 8px 0; width: 180px; color: #333;\">发票号 / Invoice #:</td>\n            <td style=\"padding: 8px 0;\">${invoiceNumber}</td>\n          </tr>\n          <tr>\n            <td style=\"padding: 8px 10px 8px 0; color: #333;\">发票日期 / Invoice Date:</td>\n            <td style=\"padding: 8px 0;\">${formatDate(orderData.createdAt) || '-'}</td>\n          </tr>\n          <tr>\n            <td style=\"padding: 8px 10px 8px 0; color: #333;\">支付日期 / Payment Date:</td>\n            <td style=\"padding: 8px 0;\">${formatDate(paymentDate) || '-'}</td>\n          </tr>\n          <tr>\n            <td style=\"padding: 8px 10px 8px 0; color: #333;\">订单号 / Order #:</td>\n            <td style=\"padding: 8px 0;\">${orderData.id || orderData.orderNumber || '-'}</td>\n          </tr>\n        </table>\n      </div>\n      \n      <div style=\"margin-bottom: 20px; padding: 5px; background-color: #f2f2f2;\">\n        <h2 style=\"margin: 0; font-size: 16px; color: #333; padding: 3px;\">订单详情 / Order Details</h2>\n      </div>\n      \n      <table style=\"width: 100%; border-collapse: collapse; font-size: 14px; margin-bottom: 30px;\">\n        <thead>\n          <tr style=\"background-color: #f9f9f9;\">\n            <th style=\"padding: 8px; border: 1px solid #ddd; text-align: left;\">产品名称 / Item</th>\n            <th style=\"padding: 8px; border: 1px solid #ddd; text-align: center;\">日期 / Date</th>\n            <th style=\"padding: 8px; border: 1px solid #ddd; text-align: center;\">人数 / Qty</th>\n            <th style=\"padding: 8px; border: 1px solid #ddd; text-align: right;\">金额 / Amount</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td style=\"padding: 12px 8px; border: 1px solid #ddd;\">\n              <div style=\"font-weight: bold;\">${productName}</div>\n              <div style=\"font-size: 12px; color: #666; margin-top: 3px;\">\n                塔斯马尼亚旅游 / Tasmania Tour\n              </div>\n            </td>\n            <td style=\"padding: 8px; border: 1px solid #ddd; text-align: center;\">\n              ${formatDate(startDate) || '-'}\n              ${endDate && startDate !== endDate ? \n                ` - ${formatDate(endDate)}` \n                : ''}\n            </td>\n            <td style=\"padding: 8px; border: 1px solid #ddd; text-align: center;\">\n              ${(orderData.tour?.adults || 0) + (orderData.tour?.children || 0)}\n            </td>\n            <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right;\">\n              ${formatPrice(subtotal)}\n            </td>\n          </tr>\n        </tbody>\n        <tfoot>\n          <tr>\n            <td colspan=\"3\" style=\"padding: 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              小计 / Subtotal:\n            </td>\n            <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right;\">\n              ${formatPrice(subtotal)}\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"3\" style=\"padding: 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              GST (10%):\n            </td>\n            <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right;\">\n              ${formatPrice(tax)}\n            </td>\n          </tr>\n          <tr style=\"background-color: #f9f9f9;\">\n            <td colspan=\"3\" style=\"padding: 12px 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              总计 / Total:\n            </td>\n            <td style=\"padding: 12px 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              ${formatPrice(totalPrice)}\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"3\" style=\"padding: 12px 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              已付款 / Paid:\n            </td>\n            <td style=\"padding: 12px 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              ${formatPrice(totalPrice)}\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"3\" style=\"padding: 12px 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              余额 / Balance Due:\n            </td>\n            <td style=\"padding: 12px 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">\n              ${formatPrice(0)}\n            </td>\n          </tr>\n        </tfoot>\n      </table>\n      \n      <div style=\"margin-bottom: 20px; font-size: 14px;\">\n        <div style=\"margin-bottom: 10px;\"><strong>支付信息 / Payment Information:</strong></div>\n        <div>支付方式 / Payment Method: 在线支付 / Online Payment</div>\n        <div>支付状态 / Payment Status: 已支付 / Paid</div>\n      </div>\n      \n      <div style=\"margin-bottom: 30px; font-size: 14px;\">\n        <div style=\"margin-bottom: 10px;\"><strong>备注 / Notes:</strong></div>\n        <div>此发票已支付，感谢您选择Happy Tassie Travel。</div>\n        <div>This invoice has been paid. Thank you for choosing Happy Tassie Travel.</div>\n      </div>\n      \n      <!-- 添加页脚 -->\n      <div style=\"border-top: 1px solid #ddd; padding-top: 10px; font-size: 12px; color: #666; text-align: center;\">\n        <div>Happy Tassie Travel</div>\n        <div>Email: info@happytassietravel.com | Tel: +61 3 1234 5678</div>\n        <div>ABN: 12 345 678 901</div>\n      </div>\n    `;\n    \n    // 添加页面到文档\n    document.body.appendChild(invoicePage);\n    \n    try {\n      // 使用html2canvas渲染页面\n      const invoiceCanvas = await html2canvas(invoicePage, {\n        scale: 2,\n        useCORS: true,\n        logging: false\n      });\n      \n      // 清理页面\n      document.body.removeChild(invoicePage);\n      \n      // 添加页面到PDF\n      const pdfWidth = pdf.internal.pageSize.getWidth();\n      const pdfHeight = (invoiceCanvas.height * pdfWidth) / invoiceCanvas.width;\n      pdf.addImage(invoiceCanvas.toDataURL('image/png'), 'PNG', 0, 0, pdfWidth, pdfHeight);\n      \n      console.log('发票生成成功');\n      \n      // 返回PDF的Blob对象\n      return pdf.output('blob');\n    } catch (error) {\n      // 确保临时元素被移除\n      if (document.body.contains(invoicePage)) {\n        document.body.removeChild(invoicePage);\n      }\n      console.error('生成PDF出错:', error);\n      throw error;\n    }\n  } catch (error) {\n    console.error('生成订单发票PDF时出错:', error);\n    throw new Error('生成订单发票失败，请稍后再试: ' + error.message);\n  }\n}; "],"names":["formatDate","dateString","date","cleanDateString","trim","match","Date","parts","split","isNaN","getTime","console","warn","toLocaleDateString","year","month","day","error","generateOrderConfirmation","async","_orderData$tour","_orderData$tour2","_orderData$tour3","_orderData$contact","_orderData$contact2","_orderData$tour4","log","orderData","jsPDF","html2canvas","default","duration","tour","Math","max","startDate","departureDate","pickupDate","endDate","returnDate","start","end","setDate","getDate","toISOString","e","itineraryData","hasItineraryDays","itinerary","Array","isArray","length","apiItineraryDays","actualDuration","productName","name","tourName","title","generateItineraryDays","itineraryHtml","sort","a","b","day_number","forEach","index","dayNumber","dayTitle","includes","concat","cleanTitle","substring","indexOf","description","stripHtmlTags","accommodationMeals","accommodation","meals","i","dayDescription","note","html","text","replace","pdf","orientation","unit","format","firstPage","document","createElement","style","padding","fontFamily","maxWidth","position","left","innerHTML","id","orderNumber","createdAt","contact","contactPerson","phone","contactPhone","pickupLocation","body","appendChild","firstPageCanvas","scale","useCORS","logging","removeChild","pdfWidth","internal","pageSize","getWidth","pdfHeight","height","width","addImage","toDataURL","secondPage","addPage","secondPageCanvas","secondPageHeight","thirdPage","thirdPageCanvas","thirdPageHeight","output","contains","Error","message","formatPrice","price","currency","arguments","undefined","numPrice","Number","toLocaleString","minimumFractionDigits","maximumFractionDigits","generateOrderInvoice","_orderData$tour5","_orderData$tour6","_orderData$tour7","_orderData$itineraryD","_orderData$itineraryD2","_orderData$contact3","_orderData$contact4","_orderData$tour8","_orderData$tour9","invoicePage","invoiceNumber","toString","slice","totalPrice","total","subtotal","tax","paymentDate","adults","children","invoiceCanvas"],"sourceRoot":""}